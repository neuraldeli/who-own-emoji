<!doctype html> 
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>who owns the emoji — demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- react 18 umd globals -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- chart.js for the history plot -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="color-scheme" content="light only">
    <style>html,body,#root{height:100%}</style>
  </head>
  <body class="bg-amber-50">
    <div id="root"></div>

    <script>
      const { useMemo, useState, useEffect, useRef } = React

      // ~60 emojis
      const EMOJIS = [
        { id:'grin', ch:'😀', label:'grinning', hue:'from-yellow-100 to-amber-100' },
        { id:'smile', ch:'😄', label:'smile', hue:'from-yellow-100 to-amber-100' },
        { id:'joy', ch:'😂', label:'joy', hue:'from-yellow-100 to-orange-100' },
        { id:'rofl', ch:'🤣', label:'rofl', hue:'from-yellow-100 to-orange-100' },
        { id:'heart', ch:'❤️', label:'heart', hue:'from-rose-100 to-pink-100' },
        { id:'hearts', ch:'😍', label:'hearts', hue:'from-rose-100 to-fuchsia-100' },
        { id:'kiss', ch:'😘', label:'kiss', hue:'from-rose-100 to-fuchsia-100' },
        { id:'sob', ch:'😭', label:'sob', hue:'from-sky-100 to-blue-100' },
        { id:'hot', ch:'🥵', label:'hot', hue:'from-orange-100 to-red-100' },
        { id:'cold', ch:'🥶', label:'cold', hue:'from-cyan-100 to-sky-100' },
        { id:'mind', ch:'🤯', label:'mind blown', hue:'from-purple-100 to-fuchsia-100' },
        { id:'cool', ch:'😎', label:'cool', hue:'from-yellow-100 to-emerald-100' },
        { id:'party', ch:'🥳', label:'party', hue:'from-purple-100 to-indigo-100' },
        { id:'skull', ch:'💀', label:'skull', hue:'from-stone-100 to-gray-100' },
        { id:'ghost', ch:'👻', label:'ghost', hue:'from-stone-100 to-gray-100' },
        { id:'alien', ch:'👽', label:'alien', hue:'from-cyan-100 to-green-100' },
        { id:'poo', ch:'💩', label:'poo', hue:'from-amber-100 to-orange-100' },
        { id:'pray', ch:'🙏', label:'pray', hue:'from-slate-100 to-zinc-100' },
        { id:'clap', ch:'👏', label:'clap', hue:'from-yellow-100 to-amber-100' },
        { id:'fire', ch:'🔥', label:'fire', hue:'from-orange-100 to-red-100' },
        { id:'star', ch:'⭐️', label:'star', hue:'from-yellow-100 to-amber-100' },
        { id:'sparkles', ch:'✨', label:'sparkles', hue:'from-yellow-100 to-amber-100' },
        { id:'zap', ch:'⚡️', label:'zap', hue:'from-yellow-100 to-orange-100' },
        { id:'boom', ch:'💥', label:'boom', hue:'from-orange-100 to-red-100' },
        { id:'rocket', ch:'🚀', label:'rocket', hue:'from-cyan-100 to-sky-100' },
        { id:'frog', ch:'🐸', label:'frog', hue:'from-lime-100 to-green-100' },
        { id:'cat', ch:'🐱', label:'cat', hue:'from-amber-100 to-yellow-100' },
        { id:'dog', ch:'🐶', label:'dog', hue:'from-amber-100 to-yellow-100' },
        { id:'fox', ch:'🦊', label:'fox', hue:'from-amber-100 to-orange-100' },
        { id:'panda', ch:'🐼', label:'panda', hue:'from-stone-100 to-gray-100' },
        { id:'bear', ch:'🐻', label:'bear', hue:'from-amber-100 to-orange-100' },
        { id:'lion', ch:'🦁', label:'lion', hue:'from-amber-100 to-orange-100' },
        { id:'unicorn', ch:'🦄', label:'unicorn', hue:'from-pink-100 to-fuchsia-100' },
        { id:'nosee', ch:'🙈', label:'no see', hue:'from-stone-100 to-zinc-100' },
        { id:'banana', ch:'🍌', label:'banana', hue:'from-yellow-100 to-amber-100' },
        { id:'peach', ch:'🍑', label:'peach', hue:'from-rose-100 to-orange-100' },
        { id:'eggplant', ch:'🍆', label:'eggplant', hue:'from-purple-100 to-indigo-100' },
        { id:'pizza', ch:'🍕', label:'pizza', hue:'from-amber-100 to-orange-100' },
        { id:'taco', ch:'🌮', label:'taco', hue:'from-amber-100 to-yellow-100' },
        { id:'sushi', ch:'🍣', label:'sushi', hue:'from-rose-100 to-orange-100' },
        { id:'coffee', ch:'☕️', label:'coffee', hue:'from-stone-100 to-zinc-100' },
        { id:'beer', ch:'🍺', label:'beer', hue:'from-amber-100 to-yellow-100' },
        { id:'wine', ch:'🍷', label:'wine', hue:'from-rose-100 to-red-100' },
        { id:'boba', ch:'🧋', label:'boba', hue:'from-amber-100 to-orange-100' },
        { id:'gift', ch:'🎁', label:'gift', hue:'from-rose-100 to-pink-100' },
        { id:'balloon', ch:'🎈', label:'balloon', hue:'from-rose-100 to-red-100' },
        { id:'trophy', ch:'🏆', label:'trophy', hue:'from-yellow-100 to-amber-100' },
        { id:'medal', ch:'🥇', label:'gold', hue:'from-yellow-100 to-amber-100' },
        { id:'gem', ch:'💎', label:'gem', hue:'from-cyan-100 to-sky-100' },
        { id:'ring', ch:'💍', label:'ring', hue:'from-amber-100 to-yellow-100' },
        { id:'money', ch:'💸', label:'money', hue:'from-emerald-100 to-green-100' },
        { id:'chart', ch:'📈', label:'chart up', hue:'from-emerald-100 to-green-100' },
        { id:'laptop', ch:'💻', label:'laptop', hue:'from-slate-100 to-zinc-100' },
        { id:'floppy', ch:'💾', label:'save', hue:'from-slate-100 to-zinc-100' },
        { id:'link', ch:'🔗', label:'link', hue:'from-slate-100 to-zinc-100' },
        { id:'lock', ch:'🔒', label:'lock', hue:'from-slate-100 to-zinc-100' },
        { id:'key', ch:'🔑', label:'key', hue:'from-amber-100 to-yellow-100' },
        { id:'globe', ch:'🌍', label:'earth', hue:'from-emerald-100 to-green-100' },
        { id:'moon', ch:'🌙', label:'moon', hue:'from-indigo-100 to-blue-100' },
        { id:'sun', ch:'☀️', label:'sun', hue:'from-yellow-100 to-amber-100' },
      ]

      const BASE_PRICE = 0.1
      const short = (addr) => (addr ? addr.slice(0,4)+'…'+addr.slice(-4) : '')
      function randomOwner() {
        const alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz'
        let s = ''; for (let i = 0; i < 44; i++) s += alphabet[Math.floor(Math.random()*alphabet.length)]
        return s
      }
      const bump = (p) => Number((p * 1.2).toFixed(3))

      function synthHistory(steals, startTime = Date.now()) {
        const hist = []; let p = BASE_PRICE; const now = startTime
        for (let i = 0; i < steals; i++) {
          const t = now - (steals - i) * (3 + Math.floor(Math.random()*7)) * 60 * 1000
          hist.push({ t, price: Number(p.toFixed(3)) }); p *= 1.2
        }
        return hist
      }

      function Header({ view, setView }) {
        return React.createElement('div', { className: 'sticky top-0 z-10 -mx-4 mb-4 bg-gradient-to-b from-amber-50/80 to-white/60 backdrop-blur' },
          React.createElement('div', { className: 'mx-auto max-w-5xl px-4 py-4 flex items-center justify-between' },
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('div', { className: 'h-9 w-9 rounded-2xl bg-gradient-to-br from-yellow-300 to-amber-400 shadow-inner grid place-items-center' },
                React.createElement('span', { className: 'text-2xl' }, '😊')
              ),
              React.createElement('div', { className: 'leading-tight' },
                React.createElement('div', { className: 'font-extrabold tracking-tight text-xl text-zinc-900' }, 'who owns the emoji'),
                React.createElement('div', { className: 'text-xs text-zinc-500' }, 'claim · steal · flex')
              )
            ),
            React.createElement('div', { className: 'flex items-center gap-2' },
              React.createElement('button', { onClick: () => setView('market'),
                className: 'rounded-xl px-3 py-2 text-sm font-semibold ' + (view==='market' ? 'bg-zinc-900 text-white' : 'bg-zinc-100 text-zinc-700 border border-zinc-200') }, 'market'),
              React.createElement('button', { onClick: () => setView('leaderboard'),
                className: 'rounded-xl px-3 py-2 text-sm font-semibold ' + (view==='leaderboard' ? 'bg-zinc-900 text-white' : 'bg-zinc-100 text-zinc-700 border border-zinc-200') }, 'leaderboard'),
              React.createElement('span', { className: 'hidden sm:inline text-xs px-2 py-1 rounded-full bg-zinc-100 text-zinc-600 border border-zinc-200' }, 'demo mode'),
              React.createElement('button', { className: 'rounded-xl px-3 py-2 text-sm font-semibold bg-zinc-900 text-white shadow hover:opacity-90' }, 'connect wallet')
            )
          )
        )
      }

      function Hero() {
        return React.createElement('div', { className: 'mt-6 rounded-3xl bg-gradient-to-br from-amber-100 to-orange-50 p-5 md:p-7 shadow-sm border border-amber-200/40' },
          React.createElement('div', { className: 'flex flex-col gap-3 md:flex-row md:items-center md:justify-between' },
            React.createElement('div', { className: 'max-w-xl' },
              React.createElement('h1', { className: 'text-2xl md:text-3xl font-extrabold tracking-tight text-zinc-900' }, 'own an emoji on-chain*'),
              React.createElement('p', { className: 'text-sm md:text-base text-zinc-600 mt-2' }, 'buy any emoji. the next person who steals it pays +20% and you get a cut. totally not a game, promise.'),
              React.createElement('p', { className: 'text-[10px] text-zinc-400 mt-1' }, '*legally you own vibes, not unicode. relax.')
            ),
            React.createElement('div', { className: 'grid grid-cols-6 gap-2 text-2xl md:text-3xl' },
              '😀❤️😭😍🐸💩🙏😎🥳💀🔥🚀'.split('').map((e, i) =>
                React.createElement('span', { key: i, className: 'grid place-items-center h-10 w-10 md:h-12 md:w-12 rounded-2xl bg-white shadow-inner border border-white/60' }, e)
              )
            )
          )
        )
      }

      function SortTab({ label, active, onClick }) {
        return React.createElement('button', {
          onClick,
          className: 'rounded-xl border px-3 py-2 text-sm transition shadow-sm ' + (active ? 'bg-zinc-900 border-zinc-900 text-white' : 'bg-white border-zinc-200 text-zinc-700 hover:bg-zinc-50')
        }, label)
      }

      function Toolbar({ q, setQ, sortKey, setSortKey }) {
        return React.createElement('div', { className: 'mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between' },
          React.createElement('div', { className: 'flex-1 relative' },
            React.createElement('input', { value: q, onChange: (e) => setQ(e.target.value), placeholder: 'search emoji or name',
              className: 'w-full rounded-2xl border border-zinc-200 bg-white px-4 py-3 pl-11 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-300' }),
            React.createElement('span', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400' }, '🔍')
          ),
          React.createElement('div', { className: 'flex items-center gap-2' },
            React.createElement(SortTab, { label: 'trending', active: sortKey === 'trending', onClick: () => setSortKey('trending') }),
            React.createElement(SortTab, { label: 'price', active: sortKey === 'price', onClick: () => setSortKey('price') }),
            React.createElement(SortTab, { label: 'steals', active: sortKey === 'steals', onClick: () => setSortKey('steals') }),
            React.createElement(SortTab, { label: 'new', active: sortKey === 'new', onClick: () => setSortKey('new') }),
          )
        )
      }

      function Stat({ label, value }) {
        return React.createElement('div', { className: 'rounded-2xl bg-white border border-zinc-200 p-3 text-center' },
          React.createElement('div', { className: 'text-[11px] uppercase tracking-wide text-zinc-500' }, label),
          React.createElement('div', { className: 'text-lg font-bold text-zinc-900' }, value)
        )
      }

      function EmojiCard({ it, onOpen, onSteal }) {
        // tiny “if stolen once” badge to telegraph profit
        const nextProfit = Number((it.price * 0.2 * 0.75).toFixed(3))
        return React.createElement('div', {
            className: 'group rounded-3xl bg-gradient-to-br from-white to-zinc-50 p-3 border border-zinc-200 shadow-sm hover:shadow transition cursor-pointer',
            onClick: onOpen
          },
          React.createElement('div', { className: `rounded-2xl bg-gradient-to-br ${it.hue} p-4 shadow-inner grid place-items-center text-5xl h-28 relative` },
            React.createElement('span', { className: 'drop-shadow-sm' }, it.ch),
            React.createElement('span', { className: 'absolute right-2 top-2 text-[10px] bg-white/80 border border-zinc-200 rounded-full px-2 py-0.5' }, `+${nextProfit} sol if stolen`)
          ),
          React.createElement('div', { className: 'mt-3 flex items-center justify-between' },
            React.createElement('div', null,
              React.createElement('div', { className: 'font-semibold text-zinc-900' }, it.label),
              React.createElement('div', { className: 'text-xs text-zinc-500' },
                it.owner ? React.createElement('span', null, 'owned by ', React.createElement('b', { className: 'font-semibold' }, short(it.owner))) : React.createElement('span', { className: 'italic text-amber-600' }, 'unclaimed')
              )
            ),
            React.createElement('div', { className: 'text-right' },
              React.createElement('div', { className: 'text-sm font-semibold text-zinc-900' }, `${it.price} SOL`),
              React.createElement('div', { className: 'text-[10px] text-zinc-500' }, `${it.steals} steals`)
            )
          ),
          React.createElement('div', { className: 'mt-3 flex gap-2' },
            React.createElement('button', {
              onClick: (e) => { e.stopPropagation(); onSteal(); },
              className: 'flex-1 rounded-xl bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white text-sm font-semibold px-3 py-2 shadow hover:opacity-90'
            }, it.owner ? 'steal' : 'claim'),
            React.createElement('button', {
              onClick: (e) => { e.stopPropagation(); onOpen(); },
              className: 'rounded-xl bg-white border border-zinc-200 text-sm px-3 py-2'
            }, 'details')
          )
        )
      }

      function Details({ it, onClose, onSteal }) {
        const canvasRef = useRef(null)
        const chartRef = useRef(null)

        useEffect(() => {
          function esc(e) { if (e.key === 'Escape') onClose() }
          window.addEventListener('keydown', esc)
          return () => window.removeEventListener('keydown', esc)
        }, [onClose])

        useEffect(() => {
          const el = canvasRef.current
          if (!el || !window.Chart) return
          if (chartRef.current) { chartRef.current.destroy(); chartRef.current = null }
          if (!it.history || it.history.length === 0) return

          const labels = it.history.map(h => new Date(h.t).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}))
          const data = it.history.map(h => h.price)

          const ctx = el.getContext('2d')
          chartRef.current = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets: [{ data, tension: 0.25, pointRadius: 3, borderWidth: 2, fill: false }] },
            options: {
              animation: false, responsive: true,
              plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `${c.parsed.y.toFixed(3)} SOL` } } },
              scales: { x: { ticks: { maxTicksLimit: 6 } }, y: { beginAtZero: false } }
            }
          })
          return () => { if (chartRef.current) chartRef.current.destroy(); chartRef.current = null }
        }, [it])

        // payout math
        const lastPrice = it.price
        const markup = Number((lastPrice * 0.20).toFixed(3))
        const sellerProfit = Number((markup * 0.75).toFixed(3))      // realized profit if stolen now
        const sellerGets = Number((lastPrice + sellerProfit).toFixed(3)) // cost returned + profit
        const treasuryGets = Number((markup * 0.25).toFixed(3))
        const buyerPays = Number((lastPrice * 1.2).toFixed(3))

        return React.createElement('div', { className: 'fixed inset-0 z-20 grid place-items-center bg-black/30 p-4', onClick: onClose },
          React.createElement('div', { className: 'w-full max-w-lg rounded-3xl bg-white p-5 md:p-6 shadow-2xl border border-zinc-200', onClick: (e) => e.stopPropagation() },
            React.createElement('div', { className: 'flex items-start justify-between gap-4' },
              React.createElement('div', { className: 'flex items-center gap-3' },
                React.createElement('div', { className: `h-16 w-16 rounded-2xl grid place-items-center text-5xl bg-gradient-to-br ${it.hue} shadow-inner` }, it.ch),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-lg font-extrabold text-zinc-900' }, it.label),
                  React.createElement('div', { className: 'text-xs text-zinc-500' }, it.owner ? `owned by ${short(it.owner)}` : 'unclaimed')
                )
              ),
              React.createElement('button', { onClick: onClose, className: 'rounded-xl px-3 py-2 text-sm bg-zinc-100 hover:bg-zinc-200' }, 'esc')
            ),
            React.createElement('div', { className: 'mt-4 grid grid-cols-3 gap-3' },
              React.createElement(Stat, { label: 'price', value: `${it.price} SOL` }),
              React.createElement(Stat, { label: 'steals', value: it.steals }),
              React.createElement(Stat, { label: 'resale math', value: 'seller gets cost + 75% of markup' }),
            ),
            React.createElement('div', { className: 'mt-4 rounded-2xl bg-zinc-50 border border-zinc-200 p-4 text-sm text-zinc-700' },
              'on each steal, the buyer pays last price × 1.2. the seller receives 100% of what they paid plus 75% of the +20% markup (= +15% profit). the treasury receives the remaining 25% of the markup (= +5% of last price). you only lose money if nobody ever steals from you.'
            ),
            React.createElement('div', { className: 'mt-4 rounded-2xl border border-zinc-200 p-4 bg-white text-sm' },
              React.createElement('div', { className: 'font-semibold text-zinc-700 mb-2' }, 'if stolen now:'),
              React.createElement('div', { className: 'grid grid-cols-4 gap-3 text-center' },
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-[11px] uppercase tracking-wide text-zinc-500' }, 'buyer pays'),
                  React.createElement('div', { className: 'text-base font-bold text-zinc-900' }, `${buyerPays} sol`)
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-[11px] uppercase tracking-wide text-zinc-500' }, 'seller gets'),
                  React.createElement('div', { className: 'text-base font-bold text-emerald-700' }, `${sellerGets} sol`)
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-[11px] uppercase tracking-wide text-zinc-500' }, 'seller PROFIT'),
                  React.createElement('div', { className: 'text-base font-bold text-emerald-700' }, `+${sellerProfit} sol`)
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-[11px] uppercase tracking-wide text-zinc-500' }, 'treasury'),
                  React.createElement('div', { className: 'text-base font-bold text-zinc-900' }, `${treasuryGets} sol`)
                ),
              )
            ),
            React.createElement('div', { className: 'mt-4' },
              React.createElement('div', { className: 'text-xs font-semibold text-zinc-600 mb-2' }, 'price history'),
              it.history && it.history.length
                ? React.createElement('canvas', { ref: canvasRef, width: 600, height: 240, className: 'w-full rounded-xl border border-zinc-200 p-2 bg-white' })
                : React.createElement('div', { className: 'text-xs text-zinc-500 italic' }, 'no steals yet.')
            ),
            React.createElement('div', { className: 'mt-5 flex items-center gap-3' },
              React.createElement('button', { onClick: onSteal, className: 'flex-1 rounded-xl bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white text-sm font-semibold px-4 py-3 shadow hover:opacity-90' }, it.owner ? 'steal now' : 'claim now'),
              React.createElement('button', { onClick: onClose, className: 'rounded-xl px-4 py-3 text-sm border border-zinc-200' }, 'close')
            )
          )
        )
      }

      function Leaderboard({ owners, onSelectOwner }) {
        const list = Object.entries(owners)
          .map(([wallet, o]) => ({ wallet, count: o.holdings.length, profit: Number(o.profit.toFixed(3)) }))
          .filter(x => x.count > 0 || x.profit > 0)
          .sort((a,b) => (b.count - a.count) || (b.profit - a.profit))

        if (!list.length) {
          return React.createElement('div', { className: 'mt-6 rounded-2xl border border-zinc-200 bg-white p-6 text-sm text-zinc-600' },
            'no owners yet. go claim something.')
        }

        return React.createElement('div', { className: 'mt-6 rounded-2xl border border-zinc-200 bg-white overflow-hidden' },
          React.createElement('div', { className: 'grid grid-cols-3 gap-0 bg-zinc-50 px-4 py-2 text-[11px] uppercase tracking-wide text-zinc-500 border-b border-zinc-200' },
            'wallet', 'emojis', 'profit (sol)'),
          list.map((row, i) =>
            React.createElement('button', {
              key: row.wallet,
              onClick: () => onSelectOwner(row.wallet),
              className: 'w-full text-left grid grid-cols-3 gap-0 px-4 py-3 border-b border-zinc-100 hover:bg-zinc-50'
            },
              React.createElement('span', { className: 'font-mono text-xs text-zinc-700' }, row.wallet),
              React.createElement('span', { className: 'text-sm font-semibold text-zinc-900' }, row.count),
              React.createElement('span', { className: 'text-sm font-semibold text-emerald-700' }, row.profit.toFixed(3))
            )
          )
        )
      }

      function OwnerModal({ wallet, owners, items, onClose, onOpenItem }) {
        const data = owners[wallet]
        const holdingIds = new Set(data?.holdings?.map(h => h.id) || [])
        const holdingItems = items.filter(it => holdingIds.has(it.id))
        const totalValue = holdingItems.reduce((s,it)=>s+it.price,0)

        return React.createElement('div', { className: 'fixed inset-0 z-30 grid place-items-center bg-black/30 p-4', onClick: onClose },
          React.createElement('div', { className: 'w-full max-w-3xl rounded-3xl bg-white p-6 shadow-2xl border border-zinc-200', onClick: (e)=>e.stopPropagation() },
            React.createElement('div', { className: 'flex items-start justify-between mb-4' },
              React.createElement('div', null,
                React.createElement('div', { className: 'text-xs uppercase tracking-wide text-zinc-500' }, 'wallet'),
                React.createElement('div', { className: 'font-mono text-sm font-semibold text-zinc-800' }, wallet),
                React.createElement('div', { className: 'text-xs text-zinc-500 mt-1' }, `profit: ${data?.profit?.toFixed(3) || '0.000'} sol · holdings value: ${totalValue.toFixed(3)} sol`)
              ),
              React.createElement('button', { onClick: onClose, className: 'rounded-xl px-3 py-2 text-sm bg-zinc-100 hover:bg-zinc-200' }, 'close')
            ),
            holdingItems.length
              ? React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4' },
                  holdingItems.map((it) =>
                    React.createElement('div', { key: it.id, className: 'cursor-pointer', onClick: () => onOpenItem(it) },
                      React.createElement('div', { className: `rounded-2xl bg-gradient-to-br ${it.hue} p-4 shadow-inner grid place-items-center text-4xl h-24` }, it.ch),
                      React.createElement('div', { className: 'mt-2 flex items-center justify-between' },
                        React.createElement('div', { className: 'text-xs text-zinc-700' }, it.label),
                        React.createElement('div', { className: 'text-xs font-semibold' }, `${it.price} sol`)
                      )
                    )
                  )
                )
              : React.createElement('div', { className: 'text-sm text-zinc-600' }, 'no holdings.')
          )
        )
      }

      function App() {
        const [view, setView] = useState('market') // 'market' | 'leaderboard'
        const [q, setQ] = useState('')
        const [sortKey, setSortKey] = useState('trending')
        // items
        const [items, setItems] = useState(() =>
          EMOJIS.map((e) => {
            const isOwned = Math.random() < 0.45
            const steals = isOwned ? Math.floor(Math.random() * 8) : 0
            const history = synthHistory(steals)
            const price = steals > 0 ? Number((BASE_PRICE * Math.pow(1.2, steals)).toFixed(3)) : BASE_PRICE
            const owner = isOwned ? randomOwner() : null
            return {
              ...e,
              owner,
              price,
              steals,
              trending: Math.random() < 0.4,
              history, // {t, price}
              purchasePrice: isOwned ? price : null, // what current owner paid
            }
          })
        )

        // owners map: wallet -> { holdings:[{id,purchasePrice}], profit:number }
        const [owners, setOwners] = useState(() => {
          const map = {}
          for (const it of items) {
            if (!it.owner) continue
            map[it.owner] ||= { holdings: [], profit: 0 }
            map[it.owner].holdings.push({ id: it.id, purchasePrice: it.purchasePrice ?? it.price })
          }
          return map
        })

        const [activeItem, setActiveItem] = useState(null)
        const [selectedOwner, setSelectedOwner] = useState(null)

        const filtered = useMemo(() => {
          const out = items.filter(i => i.label.includes(q.toLowerCase()) || i.ch.includes(q))
          const cmp =
            sortKey === 'price'  ? ((a,b) => a.price - b.price) :
            sortKey === 'new'    ? ((a,b) => (a.owner ? 1 : 0) - (b.owner ? 1 : 0)) :
            sortKey === 'steals' ? ((a,b) => b.steals - a.steals) :
                                   ((a,b) => Number(b.trending) - Number(a.trending))
          return out.slice().sort(cmp)
        }, [items, q, sortKey])

        function upsertOwner(map, wallet) {
          if (!wallet) return map
          if (!map[wallet]) map[wallet] = { holdings: [], profit: 0 }
          return map
        }

        function removeHolding(map, wallet, id) {
          if (!wallet || !map[wallet]) return
          map[wallet].holdings = map[wallet].holdings.filter(h => h.id !== id)
        }

        function onSteal(id) {
          setItems((xs) => {
            const now = Date.now()
            const ys = xs.map((x) => {
              if (x.id !== id) return x
              const prevOwner = x.owner
              const lastPrice = x.price
              const newPrice = bump(lastPrice)

              // owners/profit accounting
              setOwners((om) => {
                const m = { ...om }
                // credit prev owner's realized profit (principal is returned but not counted as profit)
                if (prevOwner) {
                  upsertOwner(m, prevOwner)
                  m[prevOwner].profit = Number((m[prevOwner].profit + lastPrice * 0.2 * 0.75).toFixed(9))
                  removeHolding(m, prevOwner, x.id)
                }
                // new owner acquires with purchasePrice = newPrice
                const newOwner = randomOwner()
                upsertOwner(m, newOwner)
                m[newOwner].holdings.push({ id: x.id, purchasePrice: newPrice })
                // update item state after we pick new owner
                x.owner = newOwner
                return m
              })

              return {
                ...x,
                price: newPrice,
                steals: x.steals + 1,
                trending: true,
                history: x.history.concat([{ t: now, price: newPrice }]),
                purchasePrice: newPrice,
              }
            })
            return ys
          })
        }

        return React.createElement('div', { className: 'min-h-screen bg-gradient-to-b from-amber-50 to-white text-zinc-800' },
          React.createElement('div', { className: 'mx-auto max-w-5xl px-4 pb-16' },
            React.createElement(Header, { view, setView }),
            React.createElement(Hero, null),

            view === 'market' && React.createElement(React.Fragment, null,
              React.createElement(Toolbar, { q, setQ, sortKey, setSortKey }),
              React.createElement('div', { className: 'mt-6 grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4' },
                filtered.map((it) =>
                  React.createElement(EmojiCard, { key: it.id, it, onOpen: () => setActiveItem(it), onSteal: () => onSteal(it.id) })
                )
              )
            ),

            view === 'leaderboard' && React.createElement(Leaderboard, {
              owners,
              onSelectOwner: (w) => setSelectedOwner(w)
            }),

            React.createElement('div', { className: 'mt-10 text-center text-xs text-zinc-400' },
              'made with ❤️ · demo ui · v0.5')
          ),

          activeItem && React.createElement(Details, { it: activeItem, onClose: () => setActiveItem(null), onSteal: () => onSteal(activeItem.id) }),
          selectedOwner && React.createElement(OwnerModal, {
            wallet: selectedOwner,
            owners,
            items,
            onClose: () => setSelectedOwner(null),
            onOpenItem: (it) => { setSelectedOwner(null); setActiveItem(it) }
          })
        )
      }

      const root = ReactDOM.createRoot(document.getElementById('root'))
      root.render(React.createElement(App))
    </script>
  </body>
</html>
